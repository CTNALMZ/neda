{
  "Application": {
    "Name": "NEDA - Staging Environment",
    "Version": "2.0.0",
    "Environment": "Staging",
    "InstanceId": "${HOSTNAME:neda-staging-}${RANDOM:1000-9999}",
    "DeploymentRegion": "EastUS2",
    "ReleaseChannel": "Beta",
    "MaintenanceMode": false,
    "FeatureFlags": {
      "EnableExperimentalFeatures": true,
      "EnableAITraining": true,
      "EnableAdvancedSecurity": false,
      "EnablePerformanceMetrics": true,
      "EnableExtendedLogging": true,
      "EnableDebugEndpoints": true,
      "EnableBetaAPIs": true
    }
  },

  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning",
      "Microsoft.Hosting.Lifetime": "Information",
      "Microsoft.EntityFrameworkCore": "Information",
      "System": "Warning",
      "NEDA": "Debug"
    },
    "Console": {
      "Enabled": true,
      "Formatter": "Json",
      "IncludeScopes": true,
      "TimestampFormat": "yyyy-MM-dd HH:mm:ss.fff"
    },
    "File": {
      "Enabled": true,
      "Path": "Logs/neda-staging-{Date}.log",
      "FileSizeLimitBytes": 10485760,
      "RetainedFileCountLimit": 31,
      "RollOnFileSizeLimit": true
    },
    "ApplicationInsights": {
      "Enabled": true,
      "InstrumentationKey": "${APPLICATIONINSIGHTS_INSTRUMENTATIONKEY}",
      "EnableAdaptiveSampling": true,
      "EnablePerformanceCounters": true,
      "EnableDependencyTracking": true,
      "EnableRequestTracking": true
    },
    "Seq": {
      "Enabled": true,
      "ServerUrl": "https://seq-staging.neda.local",
      "ApiKey": "${SEQ_API_KEY}",
      "MinimumLevel": "Debug"
    },
    "ElasticSearch": {
      "Enabled": false,
      "Uri": "https://elastic-staging.neda.local:9200",
      "IndexFormat": "neda-staging-logs-{0:yyyy.MM.dd}",
      "Username": "${ELASTIC_USERNAME}",
      "Password": "${ELASTIC_PASSWORD}"
    }
  },

  "ConnectionStrings": {
    "NEDADatabase": "Server=tcp:sql-staging.neda.local,1433;Initial Catalog=NEDA_Staging;Persist Security Info=False;User ID=${DB_USERNAME};Password=${DB_PASSWORD};MultipleActiveResultSets=True;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;Application Name=NEDA_Staging",
    "NEDACache": "${REDIS_CONNECTIONSTRING:redis-staging.neda.local:6379,ssl=true,password=${REDIS_PASSWORD},abortConnect=false,connectTimeout=30000,syncTimeout=30000}",
    "ServiceBus": "Endpoint=sb://sb-staging.neda.local/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=${SERVICE_BUS_KEY}",
    "BlobStorage": "DefaultEndpointsProtocol=https;AccountName=storagestaging;AccountKey=${BLOB_STORAGE_KEY};EndpointSuffix=core.windows.net",
    "EventHub": "${EVENT_HUB_CONNECTION_STRING}",
    "MonitoringDatabase": "Server=tcp:sql-monitoring-staging.neda.local,1433;Initial Catalog=Monitoring_Staging;User ID=${MONITORING_DB_USER};Password=${MONITORING_DB_PASSWORD};Encrypt=true;TrustServerCertificate=false"
  },

  "ApiSettings": {
    "BaseUrl": "https://api-staging.neda.local",
    "InternalBaseUrl": "https://internal-api-staging.neda.local",
    "CorsOrigins": [
      "https://staging.neda.local",
      "https://ui-staging.neda.local",
      "https://portal-staging.neda.local",
      "http://localhost:3000",
      "http://localhost:4200"
    ],
    "RateLimiting": {
      "Enabled": true,
      "PermitLimit": 100,
      "WindowInSeconds": 60,
      "QueueLimit": 10,
      "EnableEndpointRateLimiting": true
    },
    "ResponseCaching": {
      "Enabled": true,
      "DurationInSeconds": 30,
      "SizeLimitInMB": 100
    },
    "Versioning": {
      "DefaultApiVersion": "2.0",
      "ReportApiVersions": true,
      "AssumeDefaultVersionWhenUnspecified": true
    },
    "Swagger": {
      "Enabled": true,
      "RoutePrefix": "api-docs",
      "DocumentTitle": "NEDA API - Staging",
      "IncludeSecurity": true,
      "IncludeXmlComments": true
    }
  },

  "Authentication": {
    "Jwt": {
      "Issuer": "https://auth-staging.neda.local",
      "Audience": "neda-staging-api",
      "Authority": "https://auth-staging.neda.local",
      "RequireHttpsMetadata": true,
      "SaveToken": true,
      "TokenValidationParameters": {
        "ValidateIssuer": true,
        "ValidateAudience": true,
        "ValidateLifetime": true,
        "ValidateIssuerSigningKey": true,
        "ClockSkewSeconds": 30,
        "ValidAlgorithms": [ "RS256", "RS512" ]
      },
      "AccessTokenExpirationMinutes": 60,
      "RefreshTokenExpirationDays": 7
    },
    "AzureAd": {
      "Enabled": true,
      "Instance": "https://login.microsoftonline.com/",
      "TenantId": "${AZURE_TENANT_ID}",
      "ClientId": "${AZURE_CLIENT_ID}",
      "ClientSecret": "${AZURE_CLIENT_SECRET}",
      "CallbackPath": "/signin-oidc",
      "SignedOutCallbackPath": "/signout-callback-oidc"
    },
    "ApiKeys": {
      "Enabled": true,
      "HeaderName": "X-API-Key",
      "Keys": {
        "InternalServices": "${INTERNAL_API_KEY}",
        "Monitoring": "${MONITORING_API_KEY}",
        "Integration": "${INTEGRATION_API_KEY}"
      }
    }
  },

  "Authorization": {
    "Policies": {
      "AdminOnly": {
        "Roles": [ "Administrator", "SuperAdmin" ]
      },
      "EditorAccess": {
        "Roles": [ "Editor", "Administrator", "SuperAdmin" ]
      },
      "ViewerAccess": {
        "Roles": [ "Viewer", "Editor", "Administrator", "SuperAdmin" ]
      },
      "ServiceAccount": {
        "Claims": [ "service_account:true" ]
      }
    },
    "RoleMappings": {
      "Administrator": [ "users.read", "users.write", "system.admin", "audit.read" ],
      "Editor": [ "content.read", "content.write", "media.upload" ],
      "Viewer": [ "content.read", "reports.view" ]
    }
  },

  "Database": {
    "Provider": "SqlServer",
    "AutoMigrate": true,
    "SeedData": true,
    "RetryPolicy": {
      "MaxRetryCount": 5,
      "MaxRetryDelaySeconds": 30,
      "ErrorNumbersToAdd": [ 102, 4060, 40197, 40501, 40613, 49918, 49919, 49920 ]
    },
    "QueryTracking": {
      "TrackAll": false,
      "LazyLoadingEnabled": false
    },
    "ConnectionResiliency": {
      "EnableRetryOnFailure": true,
      "EnableExecutionStrategy": true
    }
  },

  "Cache": {
    "Redis": {
      "Enabled": true,
      "InstanceName": "NEDA_Staging",
      "DefaultSlidingExpirationMinutes": 30,
      "AbsoluteExpirationMinutes": 120,
      "ConnectRetry": 5,
      "ConnectTimeout": 5000,
      "SyncTimeout": 5000,
      "AllowAdmin": true,
      "Ssl": true
    },
    "Memory": {
      "Enabled": true,
      "SizeLimitMB": 512,
      "CompactionPercentage": 0.05,
      "ExpirationScanFrequencySeconds": 60
    },
    "Distributed": {
      "Enabled": true,
      "DefaultSlidingExpirationMinutes": 15
    }
  },

  "MessageBus": {
    "ServiceBus": {
      "Enabled": true,
      "PrefetchCount": 10,
      "MaxConcurrentCalls": 5,
      "AutoComplete": false,
      "MaxAutoRenewDurationMinutes": 5
    },
    "EventHub": {
      "Enabled": true,
      "ConsumerGroup": "staging",
      "CheckpointStorage": "BlobStorage",
      "PrefetchCount": 300
    },
    "RabbitMQ": {
      "Enabled": false,
      "HostName": "rabbitmq-staging.neda.local",
      "Port": 5672,
      "UserName": "${RABBITMQ_USERNAME}",
      "Password": "${RABBITMQ_PASSWORD}",
      "VirtualHost": "/"
    }
  },

  "Storage": {
    "BlobStorage": {
      "ContainerNames": {
        "Documents": "documents-staging",
        "Images": "images-staging",
        "Backups": "backups-staging",
        "Temporary": "temp-staging",
        "Logs": "logs-staging"
      },
      "RetentionPolicy": {
        "TemporaryFilesDays": 7,
        "BackupFilesDays": 30,
        "LogFilesDays": 90
      },
      "Cdn": {
        "Enabled": true,
        "BaseUrl": "https://cdn-staging.neda.local"
      }
    },
    "FileSystem": {
      "Enabled": true,
      "RootPath": "/data/staging",
      "TempPath": "/data/staging/temp",
      "MaxFileSizeMB": 100
    }
  },

  "AI": {
    "OpenAI": {
      "ApiKey": "${OPENAI_API_KEY}",
      "Organization": "${OPENAI_ORGANIZATION}",
      "DefaultModel": "gpt-4-turbo-preview",
      "MaxTokens": 4000,
      "Temperature": 0.7
    },
    "AzureOpenAI": {
      "Enabled": true,
      "Endpoint": "https://aoai-staging.neda.openai.azure.com/",
      "ApiKey": "${AZURE_OPENAI_API_KEY}",
      "DeploymentName": "gpt-4-turbo-staging",
      "MaxTokens": 2000
    },
    "ComputerVision": {
      "Enabled": true,
      "Endpoint": "https://cv-staging.neda.cognitiveservices.azure.com/",
      "ApiKey": "${COMPUTER_VISION_KEY}"
    },
    "Speech": {
      "Enabled": true,
      "Endpoint": "https://speech-staging.neda.cognitiveservices.azure.com/",
      "ApiKey": "${SPEECH_API_KEY}"
    }
  },

  "Monitoring": {
    "ApplicationInsights": {
      "EnablePerformanceCounters": true,
      "EnableDependencyTracking": true,
      "EnableRequestTracking": true,
      "EnableEventCounters": true,
      "SamplingPercentage": 100
    },
    "HealthChecks": {
      "Enabled": true,
      "Endpoint": "/health",
      "UIEndpoint": "/health-ui",
      "EvaluationTimeInSeconds": 30,
      "MinimumSecondsBetweenFailureNotifications": 60
    },
    "Metrics": {
      "Enabled": true,
      "Endpoint": "/metrics",
      "CollectionIntervalSeconds": 15
    },
    "Alerting": {
      "Enabled": true,
      "SlackWebhookUrl": "${SLACK_ALERT_WEBHOOK}",
      "TeamsWebhookUrl": "${TEAMS_ALERT_WEBHOOK}",
      "EmailRecipients": [ "devops-staging@neda.local" ]
    }
  },

  "Security": {
    "Encryption": {
      "Key": "${ENCRYPTION_KEY}",
      "IV": "${ENCRYPTION_IV}",
      "Algorithm": "AES-256-CBC"
    },
    "DataProtection": {
      "ApplicationName": "NEDA-Staging",
      "ProtectionType": "AzureBlobStorage",
      "BlobStorageConnectionString": "${DATA_PROTECTION_STORAGE}",
      "BlobContainerName": "dataprotection-keys-staging"
    },
    "Headers": {
      "StrictTransportSecurity": "max-age=31536000; includeSubDomains",
      "XContentTypeOptions": "nosniff",
      "XFrameOptions": "DENY",
      "ContentSecurityPolicy": "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://*.neda.local wss://*.neda.local;",
      "ReferrerPolicy": "strict-origin-when-cross-origin"
    },
    "AntiForgery": {
      "CookieName": ".NEDA.AntiForgery",
      "HeaderName": "X-CSRF-TOKEN",
      "RequireSsl": true
    },
    "IpSecurity": {
      "AllowedIps": [ "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16" ],
      "BlockedIps": [],
      "RateLimitByIp": true
    }
  },

  "ExternalServices": {
    "PaymentGateway": {
      "Endpoint": "https://payments-staging.neda.local",
      "ApiKey": "${PAYMENT_GATEWAY_API_KEY}",
      "TimeoutSeconds": 30
    },
    "EmailService": {
      "Endpoint": "https://email-staging.neda.local",
      "ApiKey": "${EMAIL_SERVICE_API_KEY}",
      "DefaultFrom": "noreply@staging.neda.local"
    },
    "SmsService": {
      "Endpoint": "https://sms-staging.neda.local",
      "ApiKey": "${SMS_SERVICE_API_KEY}",
      "DefaultSender": "NEDA"
    },
    "NotificationService": {
      "Endpoint": "https://notifications-staging.neda.local",
      "ApiKey": "${NOTIFICATION_SERVICE_API_KEY}"
    }
  },

  "BackgroundServices": {
    "JobScheduler": {
      "Enabled": true,
      "StorageType": "SqlServer",
      "DashboardEnabled": true,
      "DashboardPath": "/jobs"
    },
    "Workers": {
      "ImageProcessing": {
        "Enabled": true,
        "ConcurrentWorkers": 2,
        "BatchSize": 10
      },
      "DataSync": {
        "Enabled": true,
        "IntervalMinutes": 5,
        "ConcurrentWorkers": 1
      },
      "ReportGeneration": {
        "Enabled": true,
        "Schedule": "0 2 * * *",
        "RetentionDays": 30
      },
      "Cleanup": {
        "Enabled": true,
        "Schedule": "0 3 * * *",
        "RetentionDays": 7
      }
    }
  },

  "Performance": {
    "ResponseCompression": {
      "Enabled": true,
      "Providers": [ "Brotli", "Gzip" ],
      "MimeTypes": [
        "text/plain",
        "text/css",
        "application/javascript",
        "text/html",
        "application/xml",
        "text/xml",
        "application/json",
        "text/json"
      ]
    },
    "OutputCaching": {
      "Enabled": true,
      "MaximumBodySize": 10485760,
      "SizeLimit": 104857600
    },
    "MemoryManagement": {
      "GarbageCollection": {
        "ServerGC": true,
        "ConcurrentGC": true,
        "RetainVM": false
      },
      "ArrayPool": {
        "MaxArrayLength": 1048576,
        "MaxArraysPerBucket": 50
      }
    }
  },

  "Integration": {
    "UnrealEngine": {
      "Enabled": true,
      "ApiEndpoint": "https://unreal-staging.neda.local",
      "ApiKey": "${UNREAL_API_KEY}",
      "ProjectPath": "/projects/staging"
    },
    "VisualStudio": {
      "Enabled": true,
      "ExtensionPath": "/extensions/staging",
      "DebugPort": 5005
    },
    "ThirdPartyAPIs": {
      "GitHub": {
        "ApiToken": "${GITHUB_API_TOKEN}",
        "WebhookSecret": "${GITHUB_WEBHOOK_SECRET}"
      },
      "DockerRegistry": {
        "Url": "https://registry-staging.neda.local",
        "Username": "${DOCKER_REGISTRY_USER}",
        "Password": "${DOCKER_REGISTRY_PASS}"
      },
      "Kubernetes": {
        "ConfigPath": "/k8s/staging/config",
        "Namespace": "neda-staging"
      }
    }
  },

  "Localization": {
    "DefaultCulture": "en-US",
    "SupportedCultures": [ "en-US", "tr-TR", "de-DE", "fr-FR", "es-ES" ],
    "ResourcesPath": "Resources",
    "RequestLocalization": {
      "Enabled": true,
      "DefaultRequestCulture": "en-US"
    }
  },

  "Scheduling": {
    "Quartz": {
      "Enabled": true,
      "StoreType": "SqlServer",
      "TablePrefix": "QRTZ_",
      "ClusterCheckinInterval": 15000,
      "MisfireThreshold": 60000
    },
    "Hangfire": {
      "Enabled": false,
      "DashboardEnabled": true,
      "DashboardPath": "/hangfire",
      "WorkerCount": 5
    }
  },

  "Testing": {
    "MockMode": false,
    "SeedTestData": true,
    "BypassAuthentication": false,
    "PerformanceTesting": {
      "Enabled": true,
      "ThresholdMs": 1000
    }
  },

  "Deployment": {
    "SlotName": "staging",
    "RollbackEnabled": true,
    "HealthCheckEndpoint": "/health/ready",
    "WarmupEnabled": true,
    "PreDeployValidation": true,
    "PostDeployValidation": true,
    "AutoScale": {
      "Enabled": true,
      "MinInstances": 2,
      "MaxInstances": 10,
      "ScaleOutCPUThreshold": 70,
      "ScaleInCPUThreshold": 30
    }
  },

  "FeatureManagement": {
    "FeatureA": true,
    "FeatureB": false,
    "FeatureC": true,
    "ExperimentalFeature": true,
    "NewDashboard": true,
    "AdvancedAnalytics": false,
    "BetaAPI": true
  },

  "Kestrel": {
    "Endpoints": {
      "Http": {
        "Url": "http://*:80",
        "Protocols": "Http1AndHttp2"
      },
      "Https": {
        "Url": "https://*:443",
        "Certificate": {
          "Path": "/certificates/staging.pfx",
          "Password": "${CERTIFICATE_PASSWORD}"
        }
      }
    },
    "Limits": {
      "MaxRequestBodySize": 104857600,
      "MaxRequestBufferSize": 1048576,
      "MaxRequestLineSize": 8192,
      "MaxRequestHeaderCount": 100
    },
    "AllowSynchronousIO": false,
    "AddServerHeader": false
  },

  "Serilog": {
    "Using": [ "Serilog.Sinks.Console", "Serilog.Sinks.File", "Serilog.Sinks.Seq" ],
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning",
        "Microsoft.EntityFrameworkCore": "Information"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "theme": "Serilog.Sinks.SystemConsole.Themes.AnsiConsoleTheme::Code, Serilog.Sinks.Console",
          "outputTemplate": "[{Timestamp:HH:mm:ss} {Level:u3}] {Message:lj}{NewLine}{Exception}"
        }
      },
      {
        "Name": "File",
        "Args": {
          "path": "Logs/neda-staging-.log",
          "rollingInterval": "Day",
          "retainedFileCountLimit": 31,
          "fileSizeLimitBytes": 1073741824,
          "outputTemplate": "{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} [{Level:u3}] {Message:lj}{NewLine}{Exception}"
        }
      },
      {
        "Name": "Seq",
        "Args": {
          "serverUrl": "https://seq-staging.neda.local",
          "apiKey": "${SEQ_API_KEY}",
          "restrictedToMinimumLevel": "Information"
        }
      }
    ],
    "Enrich": [ "FromLogContext", "WithMachineName", "WithThreadId", "WithEnvironmentUserName" ],
    "Properties": {
      "Application": "NEDA",
      "Environment": "Staging"
    }
  },

  "Azure": {
    "KeyVault": {
      "Enabled": true,
      "VaultUri": "https://neda-staging-kv.vault.azure.net/",
      "TenantId": "${AZURE_TENANT_ID}",
      "ClientId": "${AZURE_CLIENT_ID}",
      "ClientSecret": "${AZURE_CLIENT_SECRET}"
    },
    "AppConfiguration": {
      "Enabled": true,
      "ConnectionString": "${APPCONFIGURATION_CONNECTION_STRING}"
    },
    "ManagedIdentity": {
      "Enabled": true,
      "ClientId": "${MANAGED_IDENTITY_CLIENT_ID}"
    }
  },

  "Notifications": {
    "Email": {
      "Smtp": {
        "Host": "smtp.office365.com",
        "Port": 587,
        "EnableSsl": true,
        "Username": "${SMTP_USERNAME}",
        "Password": "${SMTP_PASSWORD}"
      },
      "Templates": {
        "Welcome": "Templates/Email/Welcome.html",
        "PasswordReset": "Templates/Email/PasswordReset.html",
        "Notification": "Templates/Email/Notification.html"
      }
    },
    "Push": {
      "Enabled": true,
      "Apple": {
        "CertificatePath": "/certificates/apns-staging.p12",
        "CertificatePassword": "${APNS_CERT_PASSWORD}"
      },
      "Android": {
        "ServerKey": "${FCM_SERVER_KEY}"
      }
    },
    "WebPush": {
      "Enabled": true,
      "PublicKey": "${WEB_PUSH_PUBLIC_KEY}",
      "PrivateKey": "${WEB_PUSH_PRIVATE_KEY}"
    }
  },

  "Analytics": {
    "GoogleAnalytics": {
      "TrackingId": "UA-XXXXX-Y",
      "Enabled": false
    },
    "ApplicationInsights": {
      "Enabled": true,
      "InstrumentationKey": "${APPLICATIONINSIGHTS_INSTRUMENTATIONKEY}"
    },
    "Mixpanel": {
      "Enabled": false,
      "Token": "${MIXPANEL_TOKEN}"
    }
  },

  "Telemetry": {
    "Enabled": true,
    "SamplingRate": 1.0,
    "DisableTelemetry": false,
    "ApplicationVersion": "2.0.0",
    "CloudRoleName": "NEDA-Staging-API",
    "CloudRoleInstance": "${HOSTNAME}"
  }
}